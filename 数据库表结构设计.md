# Articles 表结构设计（兼容小红书爬虫数据）

## 表结构说明

### 基础字段（通用）
- `id`: 主键，文章唯一标识
- `source`: 来源（'xhs', 'manual', 'jina', 'mcp'）
- `source_item_id`: 原平台ID（如小红书笔记ID）
- `original_url`: 原始链接

### 内容字段
- `title`: 标题
- `summary`: 摘要（前200字符）
- `content`: 完整内容（Markdown格式）
- `content_plain`: 纯文本内容

### 作者信息
- `author`: JSON格式，存储 `{id, name, avatar}`

### 媒体资源
- `media`: JSON数组，存储 `[{type, url_local, url_source, order}]`
- `imageUrl`: 封面图URL（兼容旧字段）
- `cover_url`: 封面图URL（小红书专用）
- `video_url`: 视频URL（如果有）

### 小红书特有字段
- `xsec_token`: 小红书安全令牌
- `note_type`: 笔记类型（'normal'/'video'）

### 分类标签
- `category`: 分类
- `tags`: JSON数组，标签列表
- `topics`: JSON数组，话题列表

### 元数据
- `tone`: 语调（'Professional'/'Casual'/'Humorous'/'Deep'）
- `estimatedReadTime`: 估算阅读时间（秒）
- `language`: 语言（默认'zh'）

### 统计数据
- `metrics`: JSON格式，存储 `{likes, favorites, comments, shares}`

### 时间戳
- `created_at`: 创建/入库时间（毫秒时间戳）
- `publish_time`: 原始发布时间（毫秒时间戳）

### 抓取上下文
- `crawl_context`: JSON格式，存储 `{keyword, experiment_id, crawled_at}`

### 状态管理
- `status`: 状态（'active'/'inactive'）
- `isPublic`: 是否公开（1/0）
- `ownerId`: 所有者ID
- `deletedAt`: 删除时间（软删除）

## 字段映射（小红书 → Article）

| 小红书字段 | Article字段 | 说明 |
|-----------|------------|------|
| `id` | `source_item_id` | 笔记ID |
| `xsec_token` | `xsec_token` | 安全令牌 |
| `title` | `title` | 标题 |
| `desc` | `content_plain`, `summary` | 描述 |
| `type` | `note_type` | 笔记类型 |
| `user` | `author` | 用户信息转换 |
| `cover` | `cover_url` | 封面图 |
| `images[]` | `media[]` | 图片列表 |
| `video_url` | `video_url` | 视频URL |
| `liked_count` | `metrics.likes` | 点赞数 |
| `collected_count` | `metrics.favorites` | 收藏数 |
| `comment_count` | `metrics.comments` | 评论数 |
| `share_count` | `metrics.shares` | 分享数 |
| `time` | `publish_time` | 发布时间（秒转毫秒） |
| `tag_list[]` | `tags[]` | 标签列表 |

## 数据转换示例

### 小红书搜索返回数据
```json
{
  "id": "6938e739000000001e021b21",
  "xsec_token": "xxx",
  "title": "标题",
  "desc": "描述",
  "type": "normal",
  "user": {
    "user_id": "5f3a1b2c3d4e5f6a7b8c9d0e",
    "nickname": "用户名",
    "avatar": "https://..."
  },
  "cover": "https://...",
  "liked_count": "1.2w"
}
```

### 转换为 Article 对象
```json
{
  "id": "xhs-6938e739000000001e021b21-1234567890",
  "source": "xhs",
  "source_item_id": "6938e739000000001e021b21",
  "original_url": "https://www.xiaohongshu.com/discovery/item/6938e739000000001e021b21",
  "title": "标题",
  "summary": "描述前200字符",
  "content": "描述\n\n![图片1](/uploads/xxx.jpg)",
  "content_plain": "描述",
  "author": {
    "id": "5f3a1b2c3d4e5f6a7b8c9d0e",
    "name": "用户名",
    "avatar": "https://..."
  },
  "xsec_token": "xxx",
  "note_type": "normal",
  "cover_url": "https://...",
  "tags": ["标签1", "标签2"],
  "metrics": {
    "likes": 12000,
    "favorites": 0,
    "comments": 0,
    "shares": 0
  },
  "publish_time": 1234567890000,
  "status": "active",
  "isPublic": true
}
```

