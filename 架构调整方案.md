# 架构调整方案：Solo vs Community 双模式

## 一、当前架构分析

### 现状
- **单一内容库**：`articles` 表存储所有内容，无区分
- **单一实验模式**：所有用户共享相同的内容池
- **手动添加**：支持手动添加内容到库中

### 问题
- 无法区分个人库和公共库
- 无法实现不同的实验模式（个人 vs 社区）
- 当前"公共库"实际是"个人库"（支持手动添加）

## 二、新架构设计

### 两种实验模式

#### 1. Solo 模式（个人模式）
- **目的**：模拟个人兴趣，测试个性化推荐效果
- **内容来源**：个人内容库（`library_type='personal'`）
- **内容管理**：
  - ✅ 支持手动添加内容
  - ✅ 实验中检索的新内容自动保存到个人库
  - ✅ 每个用户有独立的个人库（`owner_id=userId`）
- **特点**：私人空间，完全个性化

#### 2. Community 模式（社区模式）
- **目的**：模拟社区共享，测试协同过滤效果
- **内容来源**：公共内容库（`library_type='community'`）
- **内容管理**：
  - ❌ 不支持手动添加
  - ✅ 实验中检索的新内容自动保存到公共库
  - ✅ 所有用户共享同一个公共库
- **特点**：众包内容，随用户使用而增长

### 三、数据库调整

#### 1. `articles` 表新增字段
```sql
ALTER TABLE articles ADD COLUMN library_type TEXT DEFAULT 'personal';  -- 'personal' | 'community'
ALTER TABLE articles ADD COLUMN owner_id TEXT;  -- Solo 模式下的所有者ID，Community 模式为NULL
```

#### 2. `experiments` 表新增字段
```sql
ALTER TABLE experiments ADD COLUMN mode TEXT DEFAULT 'solo';  -- 'solo' | 'community'
```

### 四、API调整

#### 1. 文章获取 API
- `GET /api/articles?mode=solo&userId=xxx` - 获取个人库
- `GET /api/articles?mode=community` - 获取公共库

#### 2. 文章保存 API
- `POST /api/articles` - 添加 `library_type` 和 `owner_id` 参数

#### 3. 实验相关 API
- 创建实验时传递 `mode` 参数
- 获取推荐时根据实验模式从相应的库检索

### 五、前端UI调整

#### 1. 实验创建流程
- 添加模式选择：Solo / Community
- 显示模式说明和差异

#### 2. 内容管理区（Admin.tsx）
- **Solo 模式**：
  - 标题：我的内容库
  - 功能：支持手动添加、删除
  - 筛选：只显示当前用户的个人库内容

- **Community 模式**：
  - 标题：公共内容库
  - 功能：只读，不支持手动添加
  - 筛选：显示所有公共库内容

#### 3. Feed 页面
- 根据当前实验模式从相应的库推荐内容
- 保存新检索内容时携带正确的 `library_type` 和 `owner_id`

### 六、实施步骤

1. **数据库迁移**
   - 执行 ALTER TABLE 添加新字段
   - 将现有数据标记为 'personal' + 当前用户

2. **后端API更新**
   - 更新文章查询逻辑
   - 更新实验创建和查询逻辑

3. **前端UI更新**
   - 实验创建界面
   - 内容管理界面
   - Feed推荐界面

4. **数据兼容**
   - 保证现有数据可正常访问
   - 提供数据迁移工具

### 七、用户体验

#### Solo 用户旅程
1. 创建实验 → 选择 Solo 模式
2. 填写问卷 → 生成个性化画像
3. 手动添加种子内容（可选）
4. 开始实验 → 从个人库推荐
5. 检索新内容 → 自动保存到个人库
6. 内容库随使用不断丰富

#### Community 用户旅程
1. 创建实验 → 选择 Community 模式
2. 填写问卷 → 生成个性化画像
3. 开始实验 → 从公共库推荐
4. 检索新内容 → 自动保存到公共库
5. 享受其他用户贡献的内容
6. 同时为社区贡献新内容

### 八、优势

1. **灵活性**：支持两种典型的推荐场景
2. **可对比**：可以对比个人化 vs 协同过滤效果
3. **可扩展**：公共库随社区使用自然增长
4. **隔离性**：Solo 用户不受其他用户影响
5. **真实性**：Community 模式模拟真实社区场景
